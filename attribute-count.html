<html>
<head> 
	<title> Beastiary attribute counting test </title>

	<!-- Stylesheets --> 
	<link rel="stylesheet" type="text/css" href="lib/textillate/assets/animate.css">
	<!--<link rel="stylesheet" type="text/css" href="lib/textillate/assets/animate.css">-->
	<style>
		.results
		{
			margin:auto;
			max-width:50%;
			position:absolute;
			left: 0;
		}
		.printout
		{
			margin:auto;
			max-width:50%;
			position:absolute;
			left: 50%;
		}
	</style>
</head> 

<body> 

	<h1> Attribute Counting Test </h1>
	<button onclick="clearResults()">Clear Results</button>
	<br>

	<div class="attributes">
	</div>
	<div class="results">
	</div>

	<div class="printout">

	</div>
</body> 

<!-- Scripts --> 
	<!-- Beastiary JSON --> 
	<script src="reference/clean-beastiary-2.js"> </script>
	<!-- jQuery --> 
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

	<!-- Includes for Textillate --> 
	<script src="lib/textillate/assets/jquery.lettering.js"></script>
	<script src="lib/textillate/assets/jquery.fittext.js"></script>
	<script src="lib/textillate/jquery.textillate.js"></script>

	<!-- Test Script, move once done --> 
	<script>

		var beasts = beastiary;
		var consoleCount = 0;
		var printCount = 0;
		// Array of objects representing distinct value/count per attribute
		var distinctValues = []; 
		var total = [];

		window.onload = function()
		{
			appendText('Window Loaded');
			appendText(beasts.length + ' monsters loaded.');

			// Get keys. 
			appendText('Monster attributes found.');
			var monsterKeys = getMonsterKeys(beasts[0]);

			makeAttributeClickables(monsterKeys);
			/*for(var i = 1; i < monsterKeys.length; i++)
			{
				appendText('Checking distinct values for ' + monsterKeys[i]);
				checkAttributeDistinctNameCount(monsterKeys[i]);
				appendText('---------------------------------------------------------', 'green');
			}*/
		}; 

		makeAttributeClickables = function(keys)
		{
			for(var i=0; i<keys.length; i++)
			{
				
				$("<button/>", 
				{

					class: keys[i],
					on: 
					{
						mouseup: function(event)
						{
							var myClass = $(this).attr("class");
							calculateDistinctKey(myClass);
						}
					},
					text: keys[i]
				}).appendTo('.attributes');
			}
			
		};

		clearResults = function()
		{
			$('.printout').html("");
		};

		calculateDistinctKey = function(key)
		{
			printOut("Calculating key stats for : " + key, 'red');
			checkAttributeDistinctNameCount(key);
		};

		// Get each distinct name and count of those names 
		// across a given attribute. 
		// Order by count descending. 
		checkAttributeDistinctNameCount = function(attributeName)
		{
			newAttribute = {};
			
			// Get counts
			for(var i = 0; i< beasts.length; i++)
			{
				//console.log(beasts[i][attributeName]);
				// If this name already exists, increment count
				var value = beasts[i][attributeName];
				if(newAttribute[value] !== undefined)
				{
					(newAttribute[value]).count ++;
				}
				else
				{
					newAttribute[beasts[i][attributeName]] = {}; 
					(newAttribute[beasts[i][attributeName]]).count = 1;
				}
			}

			for(var k in newAttribute)
			{
				printOut(k + ': ' + newAttribute[k].count);
			} 
			//appendText(newAttribute, 'red');

			// Sort descending
		};

		printOut = function(logText, color)
		{
			var newSelector = 'print' + printCount; 

			$('<p/>',
			{
				class: newSelector, 
				text: logText
			}).appendTo('.printout');

			/*$('.' + newSelector).textillate(
				{ 
					in: { effect: 'pulse' }
				});*/

			if(color)
			{
				$('.' + newSelector).css('color', color);
			}
			else
			{
				$('.' + newSelector).css('color', 'black');
			}
			
			printCount ++;
		}
		// Add text to the "results" div. 
		// Practicing using textillate.js as well here.
		appendText = function(logText, color)
		{
			var newSelector = 'log' + consoleCount; 

			$('<p/>',
			{
				class: newSelector, 
				text: logText
			}).appendTo('.results');

			$('.' + newSelector).textillate(
				{ 
					in: { effect: 'pulse' }
				});

			if(color)
			{
				$('.' + newSelector).css('color', color);
			}
			else
			{
				$('.' + newSelector).css('color', 'black');
			}
			
			consoleCount ++;
		};

		// Given one object, get the keys of that object.
		getMonsterKeys = function(obj)
		{
			var keys = [];

			for(var k in obj)
			{
				//appendText(k, 'blue');
				keys.push(k);
			} 
			return keys;
		};
	</script>
<!-- End Scripts --> 

</html>